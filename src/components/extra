import { useState, useEffect } from "react";
import { Link, NavLink } from "react-router-dom";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faBars, faXmark } from "@fortawesome/free-solid-svg-icons";
import {
  faPhone,
  faEnvelope,
  faLocationDot,
} from "@fortawesome/free-solid-svg-icons";
import { FaPhoneAlt, FaEnvelope, FaFacebookF, FaTwitter, FaLinkedinIn, FaWhatsapp } from "react-icons/fa";


import {
  faWhatsapp,
  faFacebookF,
  faLinkedinIn,
  faInstagram,
} from "@fortawesome/free-brands-svg-icons";


export default function Navbar() {
  const [open, setOpen] = useState(false);
  const [productOpen, setProductOpen] = useState(false);
  const [openMenu, setOpenMenu] = useState(false);
  const [activeIndex, setActiveIndex] = useState(null);

  const toggleMenu = () => {
    setOpenMenu(!openMenu);
    setActiveIndex(null);
  };

  const toggleSubMenu = (index) => {
    setActiveIndex(activeIndex === index ? null : index);
  };

  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth >= 768) {
        setProductOpen(false);
      }
    };
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);




  const navLinkClass = ({ isActive }) =>
    isActive
      ? "text-primary font-semibold border-b-2 border-primary cursor-pointer"
      : "hover:text-primary transition cursor-pointer";


  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth >= 768) {
        setOpen(false);
      }
    };

    window.addEventListener("resize", handleResize);

    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);



  const products = [
    {
      name: "Water Handling Components ",
      path: "/products/water-handling",
      children: [
        { name: "Blowers", path: "/products/water-handling/blowers" },
        { name: "Sludge Dewatering", path: "/products/water-handling/sludge-dewatering" },
        { name: "Acoustic Hoods", path: "/products/water-handling/acoustic-hoods" },
        { name: "Spare Parts / Accessories", path: "/products/water-handling/spare-parts" },
      ],
    },
    {
      name: "Waste Water Components",
      path: "/products/water-treatment",
      children: [
        { name: "Tubular Diffusers", path: "/products/water-treatment/tubular-diffusers" },
        { name: "Disc Diffusers", path: "/products/water-treatment/disc-diffusers" },
        { name: "Tubesettler Media", path: "/products/water-treatment/tubesettler-media" },
        { name: "MBBR Media", path: "/products/water-treatment/mbbr-media" },
      ],
    },
    {
      name: "Dosing Pumps & Agitators",
      path: "/products/dosingpump-agitators",
      children: [
        { name: "Electronic Dosing Pump", path: "/products/dosingpump-agitators/electronic-dosing-pump" },
        { name: "Hydraulic Pump", path: "/products/dosingpump-agitators/hydraulic-pump" },
        { name: "Mechanical  Pump", path: "/products/dosingpump-agitators/mechanical-pump" },
        { name: "Plunger Pump", path: "/products/dosingpump-agitators/plunger-pump" },
        { name: "Screw Pump", path: "/products/dosingpump-agitators/screw-pump" },
        { name: "Industrial Agitator / Mixer", path: "/products/dosingpump-agitators/industrial-agitator-mixer" },
        { name: "Dosing System", path: "/products/dosingpump-agitators/dosing-system" },
      ],
    },
    {
      name: "RO Components",
      path: "/products/ro-components",
      children: [
        { name: "Vessels", path: "/products/ro-components/vessels" },
        { name: "Pressure Tube", path: "/products/ro-components/pressure-tube" },
        { name: "Float Switch", path: "/products/ro-components/float-switch" },
        { name: "Pressure Guage", path: "/products/ro-components/pressure-guage" },
        { name: "Multiport Valve", path: "/products/ro-components/multiport-valve" },
        { name: "Distribution System", path: "/products/ro-components/distribution-system" },
        { name: "Sand", path: "/products/ro-components/sand" },
        { name: "Carbon", path: "/products/ro-components/carbon" },
      ],
    },
  ];





  return (<>

    <nav className="fixed top-0 w-full z-50 bg-dark/90 backdrop-blur border-b border-white/10">
      <div className="bg-[#1f2933] text-white text-sm hidden md:block">
        <div className="max-w-7xl mx-auto px-4 py-2 flex flex-col md:flex-row items-center justify-between gap-2">

          {/* LEFT INFO */}
          <div className="flex flex-wrap items-center gap-4">
            <span className="flex items-center gap-1">
              <FaPhoneAlt className="text-primary" />
              <a href="tel:+9175758 04585" className="hover:underline hover:text-primary">
                +91 75758 04585
              </a>
            </span>


            <span className="flex items-center gap-1">
              <FaEnvelope className="text-primary" />
              <a href="mailto:serawater007@gmail.com" className="hover:underline hover:text-primary">
                serawater007@gmail.com
              </a>
            </span>
          </div>

          {/* SOCIAL ICONS */}
          <div className="flex items-center gap-4">
            <a href="#" className="hover:text-primary">
              <FaFacebookF />
            </a>
            <a href="#" className="hover:text-primary">
              <FaTwitter />
            </a>
            <a href="#" className="hover:text-primary">
              <FaLinkedinIn />
            </a>
            <a href="https://wa.me/918668750398" target="_blank" rel="noreferrer" className="hover:text-primary">
              <FaWhatsapp />
            </a>
          </div>

        </div>
      </div>
      <div className="max-w-7xl mx-auto px-6 h-[72px] flex items-center justify-between">

        {/* LOGO */}
        <Link to="/" className="flex items-center">
          <img
            src="/images/logo/sera-logo.png"
            className="h-16 md:h-20"
            alt="Sera Water Logo"
          />
        </Link>

        {/* DESKTOP MENU */}
        <div className="hidden md:flex gap-8 text-white items-center font-body text-lg">
          <NavLink to="/" end className={navLinkClass}>Home</NavLink>
          <NavLink to="/about" className={navLinkClass}>About</NavLink>

          <div className="relative group hidden md:block cursor-pointer">
            <NavLink to="/products" className={navLinkClass}>
              Products
            </NavLink>

            {/* FIRST LEVEL DROPDOWN */}
            <div
              className="
      absolute left-0 top-full mt-2 w-64 bg-white shadow-lg rounded-md
      opacity-0 invisible group-hover:opacity-100 group-hover:visible
      transition-all duration-300 z-50
    "
            >
              <ul>
                {products.map((item, index) => (
                  <li key={index} className="relative group/item">
                    {/* Parent Item */}
                    <NavLink
                      to={item.path}
                      className="flex justify-between items-center px-4 py-2 text-sm
             text-gray-700 hover:bg-primary/10 hover:text-primary"
                    >
                      {item.name}
                      <span className="text-xs"></span>
                    </NavLink>

                    {/* SUB MENU */}
                    <div
                      className="
              absolute top-0 right-full ml-1 w-56 bg-white shadow-lg rounded-md
              opacity-0 invisible group-hover/item:opacity-100 group-hover/item:visible
              transition-all duration-300
            "
                    >
                      {item.children.map((child, idx) => (
                        <NavLink
                          key={idx}
                          to={child.path}
                          className="block px-4 py-2 text-sm text-gray-700 hover:bg-primary/10 hover:text-primary"
                        >
                          {child.name}
                        </NavLink>
                      ))}
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          </div>



          <NavLink to="/gallery" className={navLinkClass}>Gallery</NavLink>
          {/* <NavLink to="/blogs" className={navLinkClass}>Blogs</NavLink> */}
          <NavLink to="/contact" className={navLinkClass}>Contact</NavLink>

          <a
            href="tel:+91 75758 04585" target="_blank" rel="noreferrer"
            className="flex items-center gap-3 hover:text-primary transition"
          >
            <FontAwesomeIcon icon={faPhone} className="text-2xl icon" />
          </a>
        </div>

        {/* HAMBURGER */}
        <button
          className="md:hidden text-white text-2xl"
          onClick={() => setOpen(true)}
          aria-label="Open Menu"
        >
          <FontAwesomeIcon icon={faBars} className="icon" />
        </button>
      </div>

      {/* OVERLAY */}
      {open && (
        <div
          className="fixed inset-0 bg-black/80 z-40"
          onClick={() => setOpen(false)}
        />
      )}

      {/* MOBILE MENU */}
      <div
        className={`
          fixed top-0 right-0 h-screen overflow-y-auto w-full bg-dark z-50 pt-2 
          transform transition-transform duration-300
          ${open ? "translate-x-0" : "translate-x-full"}
        `}
      >
        {/* LOGO */}
        <Link to="/" className="flex items-center px-4">
          <img
            src="/images/logo/sera-logo.png"
            className="h-16"
            alt="Sera Water Logo"
          />
        </Link>

        {/* CLOSE */}
        <div className="absolute top-4 right-4">
          <button
            className="text-white text-2xl"
            onClick={() => setOpen(false)}
            aria-label="Close Menu"
          >
            <FontAwesomeIcon icon={faXmark} className="icon" />
          </button>
        </div>


        {/* MOBILE LINKS */}
        <nav className="flex flex-col gap-6 px-8 pt-4 text-textGray font-body text-lg bg-dark h-screen">

          <NavLink to="/" end className={navLinkClass} onClick={() => setOpen(false)}>
            Home
          </NavLink>
          <NavLink to="/about" className={navLinkClass} onClick={() => setOpen(false)}>
            About
          </NavLink>


          <div className="w-full">

            {/* MAIN BUTTON */}
            <button
              onClick={toggleMenu}
              className="w-full flex justify-between items-center pr-4  text-lg font-semibold"
            >
              Products
              <span className={`transition ${openMenu ? "rotate-180" : ""}`}>▼</span>
            </button>

            {/* FIRST LEVEL */}
            <div
              className={`transition-all duration-300 overflow-hidden ${openMenu ? "max-h-[500px]" : "max-h-0"
                }`}
            >
              {products.map((item, index) => (
                <div key={index} className="">

                  {/* CATEGORY */}
                  <button
                    onClick={() => toggleSubMenu(index)}
                    className="w-full text-sm flex justify-between items-center px-6 py-3 text-left font-medium"
                  >
                    <Link to={item.path}>  {item.name}</Link>
                    <span
                      className={`transition-transform ${activeIndex === index ? "rotate-180" : ""
                        }`}
                    >
                      ▾
                    </span>
                  </button>

                  {/* SUB ITEMS */}
                  <div
                    className={`overflow-hidden transition-all duration-300 ${activeIndex === index ? "max-h-54" : "max-h-0"
                      }`}
                  >
                    <div className="pl-8 pb-2">
                      {item.children.map((child, i) => (
                        <NavLink
                          key={i}
                          to={child.path}
                          className="block py-2 text-sm text-gray-600 hover:text-primary"
                        >
                          {child.name}
                        </NavLink>
                      ))}
                    </div>
                  </div>

                </div>
              ))}
            </div>
          </div>




          <NavLink to="/gallery" className={navLinkClass} onClick={() => setOpen(false)}>
            Gallery
          </NavLink>
          {/* <NavLink to="/blogs" className={navLinkClass} onClick={() => setOpen(false)}>
            Blogs
          </NavLink> */}
          <NavLink to="/contact" className={navLinkClass} onClick={() => setOpen(false)}>
            Contact
          </NavLink>

          {/* DIVIDER */}
          <div className="border-t border-white/20 "></div>

          {/* CONTACT DETAILS */}
          <div className="space-y-4 text-sm text-textGray">

            <a
              href="tel:+91 75758 04585" target="_blank" rel="noreferrer"
              className="flex items-center gap-3 hover:text-primary transition"
            >
              <FontAwesomeIcon icon={faPhone} className="text-xl" />
              <span>+91 75758 04585</span>
            </a>

            <a
              href="mailto:serawater007@gmail.com" target="_blank" rel="noreferrer"
              className="flex items-center gap-3 hover:text-primary transition pt-1"
            >
              <FontAwesomeIcon icon={faEnvelope} className="text-xl" />
              <span>serawater007@gmail.com</span>
            </a>

            <a
              href="https://maps.app.goo.gl/RaKXRTswPt5VWdQVA" target="_blank" rel="noreferrer"
              className="flex items-center gap-3 hover:text-primary transition"
            >
              <FontAwesomeIcon icon={faLocationDot} className="text-xl" />
              <span className="w-fit" >
                Shed No 94, Gajanan  Industrial Park,
                Vatva, Ahmedabad – 382445
              </span>
            </a>


          </div>

          {/* SOCIAL ICONS */}
          <div className="flex gap-4 pb-20">
            <a
              href="https://wa.me/919999999999"
              target="_blank"
              rel="noreferrer"
              className="icon-btn"
            >
              <FontAwesomeIcon icon={faWhatsapp} className="icon" />
            </a>

            <a
              href="/"
              className="icon-btn" target="_blank" rel="noreferrer"
            >
              <FontAwesomeIcon icon={faLinkedinIn} className="icon" />
            </a>

            <a
              href="/"
              className="icon-btn" target="_blank" rel="noreferrer"
            >
              <FontAwesomeIcon icon={faInstagram} className="icon" />
            </a>

            <a
              href="/"
              className="icon-btn" target="_blank" rel="noreferrer"
            >
              <FontAwesomeIcon icon={faFacebookF} className="icon" />
            </a>
          </div>

        </nav>

      </div>
    </nav>
  </>);
}
